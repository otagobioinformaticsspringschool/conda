{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Conda/Mamba","text":"<p>On this Page</p> <ul> <li>About Conda and alternatives</li> <li>How to install Conda</li> <li>How to do additional configurations</li> <li>What are Conda Environments</li> </ul>"},{"location":"#what-is-conda","title":"What is Conda","text":"<p>Conda is a cross\u2011platform package, dependency and environment manager that makes it easy to install binary packages (both Python and non\u2011Python) into isolated environments. By encapsulating exact package versions and their dependencies in a named or prefix environment, and by exporting an environment specification (for example with conda env export &gt; environment.yml), you can recreate the same software stack on another machine or share it with collaborators. To enhance the reproducibility of your research, commit the environment.yml to version control, and recreate environments with conda env create -f environment.yml to ensure analyses remain reproducible over time.</p> <p>Mamba</p> <p>Mamba is a drop in replacement for conda which has a faster package and dependency resolver.</p> <p>The <code>Miniforge3</code> environment module provides the Conda package and environment manager. Conda lets you install packages and their dependencies in dedicated environment, giving you more freedom to install software yourself at the expense of possibly less optimized packages and no curation by the REANNZ team.</p> <p>Documentation about using miniforge on REANNZ is found at https://docs.nesi.org.nz/Scientific_Computing/Supported_Applications/Miniforge3/</p>"},{"location":"#using-miniforge-and-conda-on-the-reannz-hpc","title":"Using miniforge and conda on the REANNZ HPC","text":"<p>Using miniforge on the HPC differs slightly from using it on your local computer in that miniforge itself is loaded using the <code>module</code> commands, and has some extra configurations to change some default behaviours due to the way the REANNZ HPC is set up - namely to avoid many default locations being your home directory, and instead to use project storage locations.</p>"},{"location":"#installing-conda-on-your-pc","title":"Installing conda on your PC","text":"<p>The miniforge installer nad instructions are found at https://conda-forge.org/download/</p> <p>Note</p> <p>Some bioinformatic software requires an UNIX shell to run - which involves additional steps such as installing WSL2 in Windows.</p>"},{"location":"#module-loading-and-conda-environments-isolation","title":"Module loading and conda environments isolation","text":"<p>When using the Miniforge3 module, we recommend using the following snippet to ensure that your conda environments can be activated and are isolated as possible from the rest of the system:</p> <pre><code>module purge &amp;&amp; module load Miniforge3\nsource $(conda info --base)/etc/profile.d/conda.sh\nexport PYTHONNOUSERSITE=1\n</code></pre> <p>Here are the explanations for each line of this snippet:</p> <ul> <li><code>module purge &amp;&amp; module load Miniforge3</code> ensures that no other     environment module can affect your conda environments. In     particular, the Python environment module change the <code>PYTHONPATH</code>     variable, breaking the isolation of the conda environments. If you     need other environment modules, make sure to load them after this     line.</li> <li><code>source $(conda info --base)/etc/profile.d/conda.sh</code> ensures that     you can use the <code>conda activate</code> command.</li> <li><code>export PYTHONNOUSERSITE=1</code> makes sure that local packages installed     in your home folder <code>~/.local/lib/pythonX.Y/site-packages/</code> (where     <code>X.Y</code> is the Python version, e.g. 3.8) by <code>pip install --user</code> are     excluded from your conda environments.</li> </ul> <p>Warning</p> <p>We strongly recommend against using <code>conda init</code>. It inserts a  snippet in your <code>~/.bashrc</code> file that will freeze the version of conda  used, bypassing the environment module system.</p> <p>Defaults Channel</p> <p>If you are using a <code>environment.yml</code> file, you will have to remove the  <code>defaults</code> channel, or you will receive an error.</p> <pre><code>Failed to create Conda environment\nThe channel is not accessible or is invalid.\n</code></pre> <p>The <code>defaults</code> channel is blocked due to Anaconda's licensing requirements.</p>"},{"location":"#configurations","title":"Configurations","text":""},{"location":"#prevent-conda-from-using-home-storage","title":"Prevent conda from using /home storage","text":"<p>Conda environments and the conda packages cache can take a lot of storage space. By default, Conda uses your home directory (<code>~/</code>), which is restricted to 20GB on the REANNZ HPC. Here are some techniques to avoid running out of space when using Conda.</p> <p>First, we recommend that you move the cache folder used for downloaded packages on the <code>nobackup</code> folder of your project:</p> <pre><code>conda config --add pkgs_dirs /nesi/nobackup/&lt;project_code&gt;/$USER/conda_pkgs\n</code></pre> <p>where <code>&lt;project_code&gt;</code> should be replace with your project code. This setting is saved in your <code>~/.condarc</code> configuration file.</p> <p>Prerequisite</p> <p>Your package cache will be subject to the nobackup autodelete process  (details available in the Nobackup autodelete  support page). The package cache folder is for temporary storage so it  is safe if files within the cache folder are removed.</p> <p>Reduce prompt prefix</p> <p>By default, when activating a conda environment created with <code>-p</code> or  <code>--prefix</code>, the entire path of the environment is be added to the  prompt. To remove this long prefix in your shell prompt, use the  following configuration:  </p><pre><code>conda config --set env_prompt '({name})'\n</code></pre> <p>Loading miniforge</p> <ul> <li>REANNZ docs</li> <li>setup config</li> <li>create environment</li> <li>activate environment</li> <li>install into environment</li> <li>save requirements</li> <li>load environment</li> <li>"},{"location":"#self-installing","title":"Self installing","text":"<p>If you would prefer to install and manage your own version of conda you can do so, we recommend using Miniforge to manage conda environments and packages. Miniforge is a community-led, minimal conda/mamba installer that uses conda-forge as the default channel.</p> <p>To install Miniforge under your user account, you can use the following commands:</p> <p>Terminal</p> <pre><code>wget https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-x86_64.sh\nbash Miniforge3-Linux-x86_64.sh -b -u\n</code></pre> <p>Once installed (the default location is <code>/home/&lt;user&gt;/miniforge3</code>), load conda using:</p> <p>Terminal</p> <pre><code>source ~/miniforge3/etc/profile.d/conda.sh\n</code></pre> <p>Note</p> <p>Installing miniforge and loading as above will also give you access to <code>mamba</code> which is a drop in faster replacement to <code>conda</code>.</p>"},{"location":"#extra-configuration","title":"Extra Configuration","text":""},{"location":"#bioconda","title":"Bioconda","text":"<p>Bioconda (https://bioconda.github.io) is a popular repository for bioinformatic software. To be able to make use of the bioconda repository you must configure conda to know about it. The following commands are from https://bioconda.github.io/#usage and will configure conda to search and download from the bioconda repositiory when installing into enivronments.</p> <p>Terminal</p> <pre><code>conda config --add channels bioconda\nconda config --add channels conda-forge\nconda config --set channel_priority strict\n</code></pre> <p>These commands modify your <code>~/.condarc</code> file.</p>"},{"location":"#conda-environments","title":"Conda environments","text":"<p>Conda environments let you manage software (and it's dependencies). Ultimately, conda install software into specific directories and then alters your <code>PATH</code> for you to make them accessible. To utilise an environment it must first exist, and then be activated. </p> <p>There are two types of environments: named and prefix. </p> <ul> <li> <p>Named environments are installed within your home directory (subdirectories within <code>~/.conda/envs</code>) and will let you activiate by <code>conda activate &lt;environment_name&gt;</code>.</p> </li> <li> <p>Prefix environments are installed into the location you specify at creation. If this location is accessible by others, they too can use the environment. For reproducibility it is useful to create an environment in a project directory and use that for operating on data there. When you change to a different project, you can activate the corresponding environment. This lets you manage your software at the project level.</p> </li> </ul> <p>Note</p> <p>As named environments are stored in your home directory these can take up a large portion of your home directory storage quota. They are also not accessible to others.</p> <p>The use of prefix environments is encouraged as you can specify the location to store these (ideally in your project directory)</p> <p>Warning</p> <p>We strongly recommend against using <code>conda init</code>. It inserts a snippet in your <code>~/.bashrc</code> file that will freeze the version of conda used, bypassing the environment module system.</p>"},{"location":"#creating-and-activating-an-environment","title":"Creating and activating an environment","text":"<p>Managing Conda Environments to Conserve Home Directory Storage</p> <p>To save home directory storage space, it is recommended to create Conda environments in a shared project directory.  This approach allows you to manage your Conda environments within your project directory and if needed share them with collaborators.</p> <p>Lets create an environment to practice with</p> <p>Creating Conda Environments</p> <p>Using the prefix method (REANNZ preferred method)</p> <pre><code># ensure we have a driectory\nmkdir -p ~/obss_2025/conda_envs/\n\nconda create -p ~/obss_2025/conda_envs/bioTools\n</code></pre> <p>It will show the proposed installation location, and once you answer the prompt to proceed, will do the installation.  If you have followed these instruction, this location should be <code>/home/users/&lt;your_username&gt;/obss/conda_envs/bioTools</code>. </p> <p>Once you have created your environment, you can activate it using <code>conda activate &lt;path&gt;</code> for example:</p> <p>Terminal</p> <pre><code>```bash\nconda activate ~/obss_2025/conda_envs/bioTools\n```\n</code></pre> <p>The command prompt will then change (e.g. to start with \"(myenv) \") to reflect this.  Typing conda deactivate once will return you to the base environment; typing it a second time will deactivate conda completely (as above).  | To List your conda environments type the following:</p> <p>Terminal</p> <pre><code>conda env list\n</code></pre>"},{"location":"#installing-conda-packages","title":"Installing conda packages","text":"<p>Once you have activated an environment, you can install packages with the conda install command, for example:</p> <p>Terminal</p> <pre><code>conda install gcc\n</code></pre> <p>You can also force particular versions to be installed.  See the conda cheat sheet for details.</p> <p>To list the packages installed in the currently activated environment, you can type conda list.</p>"},{"location":"#cleaning-up","title":"Cleaning up","text":""},{"location":"#cleaning-cache","title":"Cleaning Cache","text":"<p>Once you've made your environments it can be a good idea to clean up your cache </p> <p>Terminal</p> <pre><code># remove index cache, lock files, unused cache packages, tarballs, and logfiles\nconda clean --all\n</code></pre>"},{"location":"#migrating-an-existing-conda-environment","title":"Migrating an Existing Conda Environment","text":"<p>To move an existing Conda environment to a new location:</p> <ol> <li> <p>Export your current environment to a YAML file:</p> <p>Terminal</p> <pre><code>conda env export --name existing_env &gt; environment.yml\n</code></pre> </li> <li> <p>Create a new environment from the exported YAML file at your chosen location:</p> <p>Terminal</p> <pre><code>conda env create --prefix /path/to/project_directory/env/conda_envs/myenv --file environment.yml\n</code></pre> </li> <li> <p>Activate the newly created environment:</p> <p>Terminal</p> <pre><code>conda activate /path/to/project_directory/env/conda_envs/myenv\n</code></pre> </li> </ol>"},{"location":"#creating-an-alias-for-easy-activation","title":"Creating an Alias for Easy Activation","text":"<p>To simplify environment activation, consider adding an alias to your shell configuration file (e.g., <code>.bashrc</code> or <code>.bash_profile</code>):</p> <p>Terminal</p> <pre><code>alias activate_myenv=\"conda activate /path/to/project_directory/env\"\n</code></pre> <p>Activate your environment using the alias:</p> <p>Terminal</p> <pre><code>activate_myenv\n</code></pre> <p>This method is Python-version agnostic and provides a convenient way to manage Conda environments in shared or collaborative project directories.</p>"},{"location":"#removing-environments","title":"Removing environments","text":"<p>If you no longer need an environment the easiest way to remove it is:</p> <p>Terminal</p> PrefixNamed <pre><code>conda env remove -p /path/to/env\n</code></pre> <pre><code>conda env remove -n env_name\n</code></pre>"},{"location":"#running-packages-from-your-conda-environment","title":"Running packages from your conda environment","text":"<p>In order to run packages from a conda environment that you installed previously, you will first need to activate the environment in the session that you are using.  This means repeating some of the commands typed above.  Of course, you will not need to repeat the steps to create the environment or install the software, but the following may be needed again:</p> <p>Terminal</p> <pre><code>conda deactivate\n\nconda activate myenv\n</code></pre>"},{"location":"#installing-pip-packages","title":"Installing pip packages","text":"<p>Many python packages that are available via PyPI are also available as conda packages in conda-forge, and it is generally best to use these via \"conda install\" as above.</p> <p>Nonetheless, you can also install pip packages (as opposed to conda packages) into your conda environment.  However, first you should type:</p> <p>Terminal</p> <pre><code>conda install pip\n</code></pre> <p>before typing the desired commands such as</p> <p>Terminal</p> <pre><code>pip install numpy\n</code></pre> <p>If you do not install pip into your sub-environment, then either:</p> <p>your shell will fail to find the pip executable, or your shell will find pip in your base environment, which will lead to pip packages being installed into the base environment, resulting in potential interference between your conda environments Explicitly installing pip into your sub-environment will guard against this.    </p>"},{"location":"#using-conda-with-slurm","title":"Using conda with SLURM","text":"<p>In order to use conda environments within your slurm script you need to source the conda profile script so that the conda paths get set.</p> <p>Terminal</p> Modules <pre><code>#SBATCH lines go here\n\nmodule purge &amp;&amp; module load Miniforge3\nsource $(conda info --base)/etc/profile.d/conda.sh\nexport PYTHONNOUSERSITE=1\n\nconda activate /path/to/env/\n\n# code/programs to run go here\n</code></pre>"},{"location":"#exercise-redo-the-variant-calling","title":"Exercise - redo the variant calling","text":"<ol> <li>create a new environment in `~/obss_2025/genomic_dna/env</li> <li>activate and then install into it the software that is found in the <code>modload.sh</code> we used.<ul> <li>Note that the names might be slightly different and you might need to google \" bioconda\" to find out the actual package name</li> </ul> </li> <li>make a copy of the variant calling script (the original that works on the subset of data) </li> <li>turn the copy in to a slum script by adding at the top</li> <li><code>#!/bin/bash -e</code></li> <li>the needed <code>SBATCH</code> lines (mem 4GB, cpus-per-task 2, account nesi02659, walltime 00:30:00)</li> <li>add the needed lines for loading your conda environment</li> <li>open terminal to the login node and navigate to where your script is and submit it into the scheduler</li> <li>take note of the job id</li> <li>check the status with <code>squeue --me</code>, and once finished look at <code>sacct -j &lt;jobid&gt;</code>, and efficiency <code>nn_seff -j &lt;jobid&gt;</code></li> </ol>"}]}